/*!
 * An jQuery | zepto plugin for lazy loading images.
 * author -> jieyou
 * see https://github.com/jieyou/lazyload
 * use some tuupola's code https://github.com/tuupola/jquery_lazyload (BSD)
 * use component's throttle https://github.com/component/throttle (MIT)
 */
(function(a){if(typeof define==="function"&&define.amd){define(["jquery"],a)}else{a(window.jQuery||window.Zepto)}})(function(i,f){var l=window,d=i(l),g={threshold:0,failure_limit:0,event:"scroll",effect:"show",effect_params:null,container:l,data_attribute:"original",data_srcset_attribute:"original-srcset",skip_invisible:true,appear:j,load:j,vertical_only:false,check_appear_throttle_time:300,url_rewriter_fn:j,no_fake_img_loader:false,placeholder_data_img:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC",placeholder_real_img:"http://ditu.baidu.cn/yyfm/lazyload/0.0.1/img/placeholder.png"},k;function j(){}k=(function(){var o=Object.prototype.toString;return function(p){return o.call(p).replace("[object ","").replace("]","")}})();function c(o,q){var p;if(q._$container==d){p=("innerHeight" in l?l.innerHeight:d.height())+d.scrollTop()}else{p=q._$container.offset().top+q._$container.height()}return p<=o.offset().top-q.threshold}function n(o,q){var p;if(q._$container==d){p=d.width()+(i.fn.scrollLeft?d.scrollLeft():l.pageXOffset)}else{p=q._$container.offset().left+q._$container.width()}return p<=o.offset().left-q.threshold}function h(o,q){var p;if(q._$container==d){p=d.scrollTop()}else{p=q._$container.offset().top}return p>=o.offset().top+q.threshold+o.height()}function b(o,q){var p;if(q._$container==d){p=i.fn.scrollLeft?d.scrollLeft():l.pageXOffset}else{p=q._$container.offset().left}return p>=o.offset().left+q.threshold+o.width()}function a(q,p){var o=0;q.each(function(t,u){var r=q.eq(t);if((r.width()<=0&&r.height()<=0)||r.css("display")==="none"){return}function s(){r.trigger("_lazyload_appear");o=0}if(p.vertical_only){if(h(r,p)){}else{if(!c(r,p)){s()}else{if(++o>p.failure_limit){return false}}}}else{if(h(r,p)||b(r,p)){}else{if(!c(r,p)&&!n(r,p)){s()}else{if(++o>p.failure_limit){return false}}}}})}function e(o){return o.filter(function(p,q){return !o.eq(p)._lazyload_loadStarted})}function m(q,r){var v,t,s,p;var u=0;return function o(){v=this;t=arguments;var x=new Date()-u;if(!p){if(x>=r){w()}else{p=setTimeout(w,r-x)}}return s};function w(){p=0;u=+new Date();s=q.apply(v,t);v=null;t=null}}if(!i.fn.hasOwnProperty("lazyload")){i.fn.lazyload=function(q){var s=this,p,o,r;if(!i.isPlainObject(q)){q={}}i.each(g,function(u,t){if(i.inArray(u,["threshold","failure_limit","check_appear_throttle_time"])!=-1){if(k(q[u])=="String"){q[u]=parseInt(q[u],10)}else{q[u]=t}}else{if(u=="container"){if(q.hasOwnProperty(u)){if(q[u]==l||q[u]==document){q._$container=d}else{q._$container=i(q[u])}}else{q._$container=d}delete q.container}else{if(g.hasOwnProperty(u)&&(!q.hasOwnProperty(u)||(k(q[u])!=k(g[u])))){q[u]=t}}}});p=q.event=="scroll";r=q.check_appear_throttle_time==0?a:m(a,q.check_appear_throttle_time);o=p||q.event=="scrollstart"||q.event=="scrollstop";s.each(function(u,w){var v=this,A=s.eq(u),B=A.attr("src"),x=A.attr("data-"+q.data_attribute),y=q.url_rewriter_fn==j?x:q.url_rewriter_fn.call(v,A,x),z=A.attr("data-"+q.data_srcset_attribute),t=A.is("img");if(A._lazyload_loadStarted==true||B==y){A._lazyload_loadStarted=true;s=e(s);return}A._lazyload_loadStarted=false;if(t&&!B){A.one("error",function(){A.attr("src",q.placeholder_real_img)}).attr("src",q.placeholder_data_img)}A.one("_lazyload_appear",function(){var C=i.isArray(q.effect_params),E;function D(){if(E){A.hide()}if(t){if(z){A.attr("srcset",z)}if(y){A.attr("src",y)}}else{A.css("background-image",'url("'+y+'")')}if(E){A[q.effect].apply(A,C?q.effect_params:[])}s=e(s)}if(!A._lazyload_loadStarted){E=(q.effect!="show"&&i.fn[q.effect]&&(!q.effect_params||(C&&q.effect_params.length==0)));if(q.appear!=j){q.appear.call(v,A,s.length,q)}A._lazyload_loadStarted=true;if(q.no_fake_img_loader||z){if(q.load!=j){A.one("load",function(){q.load.call(v,A,s.length,q)})}D()}else{i("<img />").one("load",function(){D();if(q.load!=j){q.load.call(v,A,s.length,q)}}).attr("src",y)}}});if(!o){A.on(q.event,function(){if(!A._lazyload_loadStarted){A.trigger("_lazyload_appear")}})}});if(o){q._$container.on(q.event,function(){r(s,q)})}d.on("resize load",function(){r(s,q)});i(function(){r(s,q)});return this}}});